<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>读文笔记SSD | gwyve</title>
    <meta name="author" content="Gwyve" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="VE's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta property="wb:webmaster" content="ddb1e697310369c4" />
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>

    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">gwyve</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/3225437531/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/blog/2017/03/01/reading-note-SSD.html" title="读文笔记SSD">读文笔记SSD</a></h1>
        <p class="entry-date">2017-03-01</p>
        <p>声明：本博客欢迎转发，但请保留原作者信息!    <br />
作者：高伟毅  <br />
博客：<a href="https://gwyve.github.io/">https://gwyve.github.io/</a>  <br />
微博：<a href="http://weibo.com/u/3225437531/">http://weibo.com/u/3225437531/</a></p>

<h2 id="引言">引言</h2>
<p>这篇文章是在YOLO<sub>[1]</sub>之后的一篇文章，这篇文章目前是一篇the-art-of-state的方法。这篇文章可以看到很多前人的影子，我所感受到这篇文章主要借鉴前人的有DeepNultiBox<sub>[2]</sub>、Faster R-CNN<sub>[3]</sub>、YOLO<sub>[1]</sub>、VGG16<sub>[4]</sub>等。</p>

<h2 id="发表位置">发表位置</h2>

<ul>
  <li>ECCV 2016</li>
  <li><a href="https://arxiv.org/pdf/1512.02325.pdf">PDF.v5 arXiv：1512.02325.pdf</a></li>
  <li><a href="https://github.com/weiliu89/caffe/tree/ssd">代码托管</a></li>
</ul>

<h2 id="问题引入">问题引入</h2>

<p>对于object detection，之前的方法都没有特别快，虽然YOLO很快，但是在准确性上下降了较多。作者就提出了一个速度很好，准确性还好的方法——SSD。</p>

<h2 id="ssd核心思想">SSD核心思想</h2>

<p>整个图片做输入，之后在输出层回归出box的位置和object的类别。与YOLO不同的是，SSD在输出层只用conv layer，而不是全链接层。</p>

<h2 id="模型">模型</h2>

<p><img src="/images/blog/2017-3-1/model.png" alt="model" />                     <br />
这个模型，是以VGG16进行修改的，把VGG16的fc层换成conv层，中间还夹杂了maxpooling层。每个额外添加的conv层都输出一个Feature map，并以此作为预测一个输入，换句话说，这些不同scale的Feature map都作为预测的输入，以此来达到不同scale。作者举了一个例子，如果一个Feature map是m×n×p（width×height×channel）的，那么用3×3×p的kernel去产生value，产生了m×n个value。</p>

<p>为了方便读者理解这个网络结构，我把VGG<sub>[4]</sub>论文中的图粘贴过来了，作者用的是D这个模型进行修改的。
<img src="/images/blog/2017-3-1/VGG.png" alt="VGG" /></p>

<h2 id="训练">训练</h2>

<h3 id="default-boxes">default boxes</h3>

<p>作者在这里提到的default boxes与faster R-CNN中的Anchor很类似，这里是按照YOLO中的想法，把每个Feature map（不同scale的）分成m×n个cell，每个cell有默认出k个default boxes，最后的predict box与default box有4个offset，并为每个predict box计算c个类的值。最后产生了（c+4）kmn个值。这里与faster R-CNN Anchor最大的不同就是，faster R-CNN是通过改变Anchor的大小来实现scalable的，SSD是改变Feature map大小来实现的。
<img src="/images/blog/2017-3-1/framework.png" alt="frameword" /></p>

<h3 id="训练目标">训练目标</h3>

<p>损失函数：这个与Faster R-CNN中的RPN是一样的，不过RPN是预测box里面有object或者没有，所以，没有分类，SSD直接用的softmax分类。location的损失，还是一样，都是用predict box和default box/Anchor的差 与 ground truth box和default box/Anchor的差 进行对比，求损失。                      <br />
<img src="/images/blog/2017-3-1/loss.png" alt="loss" /></p>

<p>以下，是我根据我的理解画的一张简单示意图。这个default box存在求损失，就是尽可能把X与Y的数值做到差值最小。</p>

<p><img src="/images/blog/2017-3-1/loss_.png" alt="loss" /></p>

<h3 id="为default-box选择尺度scale和长宽比">为default box选择尺度（scale）和长宽比</h3>

<p>如果我们用m个Feature maps进行预测，那么尺度最大的是s<sup>max</sup>，最小的是s<sup>min</sup>，那么第k个Feature map的default boxes的尺度s<sup>k</sup>：
<img src="/images/blog/2017-3-1/scale.png" alt="scale" />                      <br />
使用不同的长宽比，a<sup>r</sup>∈{1,2,3,1/2,1/3}，长度（w<sup>r</sup> = s<sup>k</sup> × squr(a<sup>r</sup>)），高度（h<sup>r</sup> = s<sup>k</sup> / squr(a<sup>r</sup>)）。除此之外，对于a<sup>r</sup>=1，还有一个情况s<sup>k</sup>‘= squr(s<sup>k</sup> × s<sup>k+1</sup>)。</p>

<h3 id="negative数据处理">negative数据处理</h3>

<p>这种方法会产生很多个negative的数据，使positive与negative失去平衡，作者把negative：positive控制在3:1。</p>

<h3 id="数据扩大">数据扩大</h3>
<p><img src="/images/blog/2017-3-1/data_augmentation.png" alt="data_augmentation" /></p>

<h2 id="实验结果">实验结果</h2>

<h3 id="pascal-voc2007">PASCAL VOC2007</h3>

<p><img src="/images/blog/2017-3-1/VOC2007.png" alt="VOC2007" /></p>

<h3 id="pascal-voc2012">PASCAL VOC2012</h3>

<p><img src="/images/blog/2017-3-1/VOC2012.png" alt="VOC2012" /></p>

<h3 id="coco">COCO</h3>

<p><img src="/images/blog/2017-3-1/COCO.png" alt="COCO" /></p>

<h2 id="模型分析">模型分析</h2>

<h3 id="数据扩大很重要">数据扩大很重要</h3>

<p><img src="/images/blog/2017-3-1/data_augmentation_effect.png" alt="data_augmentation_effect" /></p>

<h3 id="多个default-box-尺度更好">多个default box 尺度更好</h3>

<h3 id="atrous-更快">atrous 更快</h3>

<p>目前，我还没有明白atrous是什么。</p>

<h3 id="多个feature-map用于预测更好">多个Feature map用于预测更好</h3>

<p><img src="/images/blog/2017-3-1/multiple_layers.png" alt="multiple_layers" /></p>

<h3 id="ssd定位错误少">SSD定位错误少</h3>

<p>因为他把定位和分类放在一步里解决。</p>

<p><img src="/images/blog/2017-3-1/analysis.png" alt="analysis" /></p>

<h3 id="小目标效果不好">小目标效果不好</h3>

<p>因为在top layer中，获得小目标的信息不多，扩大图片大小输入，会有改善。通过数据扩大也会有改善。</p>

<p><img src="/images/blog/2017-3-1/smallobject.png" alt="smallobject" /></p>

<h2 id="速度">速度</h2>

<p>使用 Titan X 、 cuDNN v4 、 Intel Xeon E5-2667v3@3.20GHz。</p>

<p><img src="/images/blog/2017-3-1/speed.png" alt="speed" /></p>

<h2 id="结论">结论</h2>

<ul>
  <li>SSD的各种特定和优点。</li>
  <li>SSD将会获得更为广泛的应用。</li>
</ul>

<h2 id="个人想法">个人想法</h2>

<p>这篇文章在很早之前就想拜读，但是，到今天才扣完。之前读的object Detection文章基本都是在为了这篇做基础。这篇文章看完了，想法有很多，现在简单叙述一下把。</p>

<h3 id="巨人肩膀">巨人肩膀</h3>

<ul>
  <li><strong>DeepMultiBox:</strong>这篇文章主要讲的多个scale的问题，利用图片放缩的方法进行不同scale多个框预测。文章在最后提到把定位分类放到one-shot的网络里面，我觉得作者可能受到这个的启发。</li>
  <li><strong>YOLO:</strong>YOLO这篇文章就是把定位和分类放在一个网络里面，同时彻底摆脱了之前位置推荐的方式。SSD中的default box的生成借鉴了YOLO中cell的想法。SSD在很多方面都是在于YOLO做对比。毕竟YOLO是发表在CVPR2016上的成果。</li>
  <li><strong>Faster R-CNN:</strong>这篇文章主要借鉴了Faster R-CNN中anchor的想法。正如作者在提到“similar to Faster R-CNN”，SSD里面提到的“default bounding box”直接按照anchor理解的话，便容易理解多了，SSD与Faster R-CNN中关于Anchor的使用区别主要在Scalable上。</li>
  <li><strong>VGG16:</strong>这个主要说的是个网络结构，SSD主要就是根据VGG16改的，VGG16中抛弃了之前用的5×5、7×7、11×11等大的卷积核，而是全用3×3的卷积核（VGG文章中提到了具体原因，大主要有1.更多个non-linear rectification layers.）。</li>
</ul>

<h3 id="作者提到的改进空间">作者提到的改进空间</h3>

<ul>
  <li>“How to design the optimal tiling is an open question as well”，这是作者在提到default box的尺度问题时候说的。</li>
  <li>针对small object的问题，这个跟YOLO是一致的，我觉得这很可能是这样划分cell的问题。</li>
</ul>

<h2 id="注释">注释</h2>
<p>[1]Redmon, J., Divvala, S., Girshick, R., Farhadi, A.: You only look once: Unified, real-time object detection. In: CVPR. （2016)                   <br />
[2]Erhan, D., Szegedy, C., Toshev, A., Anguelov, D.: Scalable object detection using deep neural networks. In: CVPR. (2014)                    <br />
[3]Zhang, L., Lin, L., Liang, X., He, K.: Is faster r-cnn doing well for pedestrian detection. In:ECCV. (2016)                               <br />
[4]Simonyan, K., Zisserman, A.: Very deep convolutional networks for large-scale image recognition.In: NIPS. (2015)</p>


        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
                <script type="text/javascript" charset="utf-8">
                (function(){
                  var _w = 86 , _h = 16;
                  var param = {
                    url:location.href,
                    type:'6',
                    count:'', /**是否显示分享数，1显示(可选)*/
                    appkey:'', /**您申请的应用appkey,显示分享来源(可选)*/
                    title:'', /**分享的文字内容(可选，默认为所在页面的title)*/
                    pic:'', /**分享图片的路径(可选)*/
                    ralateUid:'3225437531', /**关联用户的UID，分享微博会@该用户(可选)*/
                    language:'zh_cn', /**设置语言，zh_cn|zh_tw(可选)*/
                    rnd:new Date().valueOf()
                  }
                  var temp = [];
                  for( var p in param ){
                    temp.push(p + '=' + encodeURIComponent( param[p] || '' ) )
                  }
                  document.write('<iframe allowTransparency="true" frameborder="0" scrolling="no" src="https://hits.sinajs.cn/A1/weiboshare.html?' + temp.join('&') + '" width="'+ _w+'" height="'+_h+'"></iframe>')
                })()
                </script>
            </div>
<!--
            <a href="#" class="comment" onclick="return false;">点击查看评论</a>
-->
            <div id="disqus_thread"></div>
        </div>
    </div>

    <div class="sidenav">
        <iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="https://widget.weibo.com/weiboshow/index.php?language=&width=0&height=75&fansRow=2&ptype=1&speed=0&skin=5&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=3225437531&verifier=87199cd9&dpc=1"></iframe>
    </div>



    <div class="sidenav">
        <h2>Blog</h2>
        <ul class="artical-list">
        
            <li><a href="/blog/2017/07/16/reading-note-the-truth-about-self-driving-cars.html">读文笔记 The Truth About "self-driving" Cars</a></li>
        
            <li><a href="/blog/2017/05/17/reading-note-A-Fast-RCNN.html">读文笔记A-Fast-RCNN</a></li>
        
            <li><a href="/blog/2017/05/02/double-power.html">双电源供电</a></li>
        
            <li><a href="/blog/2017/04/11/reading-note-FPN.html">读文笔记FPN</a></li>
        
            <li><a href="/blog/2017/04/10/reading-note-Speed-Accuracy.html">读文笔记Speed/Accuracy trade-offs</a></li>
        
            <li><a href="/blog/2017/03/29/reading-note-R-FCN.html">读文笔记R-FCN</a></li>
        
            <li><a href="/blog/2017/03/27/caffe-add-layer.html">caffe添加新layer</a></li>
        
            <li><a href="/blog/2017/03/20/reading-note-ResNet.html">读文笔记ResNet</a></li>
        
            <li><a href="/blog/2017/03/01/reading-note-SSD.html">读文笔记SSD</a></li>
        
            <li><a href="/blog/2017/02/24/reading-note-DeepMultiBox.html">读文笔记DeepMultiBox</a></li>
        
            <li><a href="/blog/2017/02/15/reading-note-YOLO.html">读文笔记YOLO</a></li>
        
            <li><a href="/blog/2017/01/05/reading-note-Faster-R-CNN.html">读文笔记Faster R-CNN</a></li>
        
            <li><a href="/blog/2016/12/28/reading-note-Fast-R-CNN.html">读文笔记Fast R-CNN</a></li>
        
            <li><a href="/blog/2016/12/23/reading-note-sppnet.html">读文笔记SPPnet</a></li>
        
            <li><a href="/blog/2016/12/11/who-i-am.html">我是谁</a></li>
        
        </ul>
<!--
        <h2>Opinion</h2>
        <ul class="artical-list">
        
        </ul>
-->
        <h2>Project</h2>
        <ul class="artical-list">
        
            <li><a href="/project/2017/03/25/ServerOnAndroid.html">ServerOnAndroid</a></li>
        
            <li><a href="/project/2017/03/05/cuda-tensorflow-install.html">cuda && tensorflow 安装</a></li>
        
            <li><a href="/project/2016/12/19/LuceneForAndroid.html">LuceneForAndroid</a></li>
        
        </ul>
    </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>


    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })
    </script>
</body>
</html>
