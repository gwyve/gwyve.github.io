<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>cuda && tensorflow 安装 | gwyve</title>
    <meta name="author" content="Gwyve" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="VE's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta property="wb:webmaster" content="ddb1e697310369c4" />
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>

    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">gwyve</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/3225437531/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/project/2017/03/05/cuda-tensorflow-install.html" title="cuda && tensorflow 安装">cuda && tensorflow 安装</a></h1>
        <p class="entry-date">2017-03-05</p>
        <p>声明：本博客欢迎转发，但请保留原作者信息!    <br />
作者：高伟毅  <br />
博客：<a href="https://gwyve.github.io/">https://gwyve.github.io/</a>  <br />
微博：<a href="http://weibo.com/u/3225437531/">http://weibo.com/u/3225437531/</a></p>

<h2 id="引言">引言</h2>

<p>使用NVIDIA GPU进行dnn目前已经成为了主流，年前就打算自行安装一遍，拖了这么长时间，到今天才弄得差不多了。本来觉得这个不打算写个东西的，后来怕忘了，还是写下来吧</p>

<h2 id="设备介绍">设备介绍</h2>

<p>主机: ThinkStation-P300     <br />
CPU: Intel(R) Core(TM) i7-4790 CPU @ 3.60GHz            <br />
GPU: Tesla K20c</p>

<h2 id="所需软件">所需软件</h2>

<p>以下软件，在国内只有tensorflow需要翻墙，NVIDIA的都可以直接下载，速度还可以的</p>

<h3 id="ubuntu">Ubuntu</h3>

<p><a href="https://www.ubuntu.com/download/alternative-downloads">Ubuntu 16.04.2 LTS</a>                 <br />
<a href="http://releases.ubuntu.com/16.04/ubuntu-16.04.2-desktop-amd64.iso.torrent?_ga=1.169319585.1810803403.1486517128">file_torrent</a></p>

<h3 id="驱动">驱动</h3>

<p><a href="http://www.nvidia.cn/download/driverResults.aspx/115286/cn">Nvidia-375.39</a>                             <br />
<a href="http://cn.download.nvidia.com/XFree86/Linux-x86_64/375.39/NVIDIA-Linux-x86_64-375.39.run">file</a></p>

<h3 id="cuda">cuda</h3>

<p><a href="https://developer.nvidia.com/cuda-downloads">cuda-8.0</a>                        <br />
<a href="https://developer.nvidia.com/compute/cuda/8.0/Prod2/local_installers/cuda_8.0.61_375.26_linux-run">file</a></p>

<h3 id="cudnn">cuDNN</h3>

<p><a href="https://developer.nvidia.com/rdp/cudnn-download">cuDNN_5.1</a>                       <br />
<a href="https://developer.nvidia.com/compute/machine-learning/cudnn/secure/v5.1/prod_20161129/8.0/cudnn-8.0-linux-x64-v5.1-tgz">file</a></p>

<h3 id="tensorflow">tensorflow</h3>

<p>需要翻墙</p>

<p><a href="https://www.tensorflow.org/install/install_linux#installing_with_native_pip">tensorflow_1.0.0</a>                              <br />
<a href="https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.0.0-cp27-none-linux_x86_64.whl">file_gpu_python2.7</a></p>

<h2 id="安装步骤">安装步骤</h2>

<h3 id="系统安装">系统安装</h3>

<p>安装Ubuntu的过程自行搜索吧，教程很多，在此不说了。</p>

<h3 id="安装nvidia-driver">安装NVIDIA Driver</h3>

<p>起初，我是选择使用直接安装cuda的，cuda中有driver，但是，cuda安装完了之后，重复出现登录界面，无法进入系统，所以，我选择单独安装driver，然后，再安装cuda。解决重复登录界面参考<a href="http://blog.csdn.net/u012759136/article/details/53355781">参考1</a></p>

<p>1.<a href="http://www.nvidia.cn/Download/index.aspx?lang=cn">选择</a>机子所需要的驱动，并下载。                <br />
2.卸载原有驱动：</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo apt-get remove –purge nvidia<span class="k">*</span>
</code></pre>
</div>
<p>3.关闭nouveau                                 <br />
创建 /etc/modprobe.d/blacklist-nouveau.conf并包含</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>blacklist nouveau
options nouveau <span class="nv">modeset</span><span class="o">=</span>0
</code></pre>
</div>
<p>在terminal输入</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo update-initramfs -u
</code></pre>
</div>
<p>4.进入命令行模式                          <br />
Ctrl+Alt+F1            <br />
5.关闭lightdm服务</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo service lightdm stop
</code></pre>
</div>
<p>6.运行驱动文件
改变权限</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo chmod a+x NVIDIA-Linux-x86_64-375.39.run
</code></pre>
</div>
<p>运行  <strong>注意参数</strong></p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo ./NVIDIA-Linux-x86_64-375.39.run –no-x-check –no-nouveau-check –no-opengl-files
</code></pre>
</div>

<ul>
  <li>no-x-check 安装驱动时关闭X服务</li>
  <li>no-nouveau-check 安装驱动时禁用nouveau</li>
  <li>no-opengl-files 只安装驱动文件，不安装OpenGL文件</li>
</ul>

<p>7.重启，不出现循环登录问题</p>

<h3 id="安装cuda">安装cuda</h3>

<p>本来是按照deb安装的，后来各种问题，就改成选择runfile的方式了。</p>

<p>这里主要参考<a href="http://docs.nvidia.com/cuda/cuda-installation-guide-linux/#runfile-nouveau-ubuntu">参考2</a>，全是英文的，要是不想看英文的话，我觉得，那还是放弃做dnn吧，目前这个前沿领域中文文献比较少～</p>

<p>1.在运行.run文件之后，在选择是否安装驱动的位置选择no，剩下的都是yes。                     <br />
2.添加环境变量                    <br />
打开 ～/.bashrc在最后添加</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/usr/local/cuda/bin:<span class="nv">$PATH</span>
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/usr/local/cuda/lib:<span class="nv">$LD_LIBRARY_PATH</span>
</code></pre>
</div>
<p>在terminal输入</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">source</span> ~/.bashrc
</code></pre>
</div>
<p>3.测试cuda安装是否成功</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>nvcc -V
</code></pre>
</div>
<p>输入cuda的版本信息                     <br />
4.测试samples                    <br />
这部分参考<a href="http://blog.csdn.net/u012235003/article/details/54575758">参考3</a></p>

<p>进入 NVIDIA_CUDA-8.0-Samples/</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>make
</code></pre>
</div>
<p>运行NVIDIA_CUDA-8.0-Samples/bin/x86_64/linux/release/deviceQuery</p>

<p><img src="/images/project/2017-3-5/pass.png" alt="pass" /></p>

<p>显示最后出现“Resalt=PASS”，代表成功</p>

<h3 id="安装cudnn">安装cuDNN</h3>

<p>这个都不应该叫做安装，就是一个创建链接的过程。这个主要参考<a href="http://blog.csdn.net/jk123vip/article/details/50361951">参考4</a></p>

<p>1.下载tar文件，解压                       <br />
解压出一个叫做cuda的文件夹，以下操作都是在该文件夹下进行                <br />
2.复制文件</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo cp include/cudnn.h /usr/local/include
<span class="gp">$ </span>sudo cp lib64/libcudnn.so /usr/local/lib
<span class="gp">$ </span>sudo cp lib64/libcudnn.so.5 /usr/local/lib
<span class="gp">$ </span>sudo cp lib64/libcudnn.so.5.1.10 /usr/local/lib
</code></pre>
</div>
<p>3.创建链接</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo ln -sf /usr/local/lib/libcudnn.so.5.1.10 /usr/local/lib/libcudnn.so.5
<span class="gp">$ </span>sudo ln -sf /usr/local/lib/libcudnn.so.5 /usr/local/lib/libcudnn.so
<span class="gp">$ </span>sudo ldconfig -v
</code></pre>
</div>

<h3 id="安装tensorflow">安装tensorflow</h3>

<p>根据<a href="https://www.tensorflow.org/install/install_linux">参考5</a>，可以用的方式很多，我是按照那个virtaulenv的方式，可用。这个也是英文的，还是那句话，目前这块中文文献很少。</p>

<h2 id="参考">参考</h2>

<p>1.<a href="http://blog.csdn.net/u012759136/article/details/53355781">【解决】Ubuntu安装NVIDIA驱动后桌面循环登录问题</a>                              <br />
2.<a href="http://docs.nvidia.com/cuda/cuda-installation-guide-linux/#runfile-nouveau-ubuntu">NVIDIA CUDA Installation Guide for Linux</a>       <br />
3.<a href="http://blog.csdn.net/u012235003/article/details/54575758">二、CUDA安装和测试</a>              <br />
4.<a href="http://blog.csdn.net/jk123vip/article/details/50361951">import TensorFlow提示Unable to load cuDNN DSO</a>                      <br />
5.<a href="https://www.tensorflow.org/install/install_linux">Installing TensorFlow on Ubuntu</a></p>


        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
                <script type="text/javascript" charset="utf-8">
                (function(){
                  var _w = 86 , _h = 16;
                  var param = {
                    url:location.href,
                    type:'6',
                    count:'', /**是否显示分享数，1显示(可选)*/
                    appkey:'', /**您申请的应用appkey,显示分享来源(可选)*/
                    title:'', /**分享的文字内容(可选，默认为所在页面的title)*/
                    pic:'', /**分享图片的路径(可选)*/
                    ralateUid:'3225437531', /**关联用户的UID，分享微博会@该用户(可选)*/
                    language:'zh_cn', /**设置语言，zh_cn|zh_tw(可选)*/
                    rnd:new Date().valueOf()
                  }
                  var temp = [];
                  for( var p in param ){
                    temp.push(p + '=' + encodeURIComponent( param[p] || '' ) )
                  }
                  document.write('<iframe allowTransparency="true" frameborder="0" scrolling="no" src="https://hits.sinajs.cn/A1/weiboshare.html?' + temp.join('&') + '" width="'+ _w+'" height="'+_h+'"></iframe>')
                })()
                </script>
            </div>
<!--
            <a href="#" class="comment" onclick="return false;">点击查看评论</a>
-->
            <div id="disqus_thread"></div>
        </div>
    </div>

    <div class="sidenav">
        <iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="https://widget.weibo.com/weiboshow/index.php?language=&width=0&height=75&fansRow=2&ptype=1&speed=0&skin=5&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=3225437531&verifier=87199cd9&dpc=1"></iframe>
    </div>



    <div class="sidenav">
        <h2>Blog</h2>
        <ul class="artical-list">
        
            <li><a href="/blog/2017/07/16/reading-note-the-truth-about-self-driving-cars.html">读文笔记 The Truth About "self-driving" Cars</a></li>
        
            <li><a href="/blog/2017/05/17/reading-note-A-Fast-RCNN.html">读文笔记A-Fast-RCNN</a></li>
        
            <li><a href="/blog/2017/05/02/double-power.html">双电源供电</a></li>
        
            <li><a href="/blog/2017/04/11/reading-note-FPN.html">读文笔记FPN</a></li>
        
            <li><a href="/blog/2017/04/10/reading-note-Speed-Accuracy.html">读文笔记Speed/Accuracy trade-offs</a></li>
        
            <li><a href="/blog/2017/03/29/reading-note-R-FCN.html">读文笔记R-FCN</a></li>
        
            <li><a href="/blog/2017/03/27/caffe-add-layer.html">caffe添加新layer</a></li>
        
            <li><a href="/blog/2017/03/20/reading-note-ResNet.html">读文笔记ResNet</a></li>
        
            <li><a href="/blog/2017/03/01/reading-note-SSD.html">读文笔记SSD</a></li>
        
            <li><a href="/blog/2017/02/24/reading-note-DeepMultiBox.html">读文笔记DeepMultiBox</a></li>
        
            <li><a href="/blog/2017/02/15/reading-note-YOLO.html">读文笔记YOLO</a></li>
        
            <li><a href="/blog/2017/01/05/reading-note-Faster-R-CNN.html">读文笔记Faster R-CNN</a></li>
        
            <li><a href="/blog/2016/12/28/reading-note-Fast-R-CNN.html">读文笔记Fast R-CNN</a></li>
        
            <li><a href="/blog/2016/12/23/reading-note-sppnet.html">读文笔记SPPnet</a></li>
        
            <li><a href="/blog/2016/12/11/who-i-am.html">我是谁</a></li>
        
        </ul>
<!--
        <h2>Opinion</h2>
        <ul class="artical-list">
        
        </ul>
-->
        <h2>Project</h2>
        <ul class="artical-list">
        
            <li><a href="/project/2017/03/25/ServerOnAndroid.html">ServerOnAndroid</a></li>
        
            <li><a href="/project/2017/03/05/cuda-tensorflow-install.html">cuda && tensorflow 安装</a></li>
        
            <li><a href="/project/2016/12/19/LuceneForAndroid.html">LuceneForAndroid</a></li>
        
        </ul>
    </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>


    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })
    </script>
</body>
</html>
